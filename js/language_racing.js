"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _iterableToArrayLimit(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var r,a,i=[],o=!0,u=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){u=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(u)throw a}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var RacingBarsAudio=function(){function e(t){_classCallCheck(this,e),this.svg=t,this.currentData={},this.datetext={},this.width=0,this.height=0,this.margin={},this.ini_date=new Date,this.top_n=0,this.tickDuration=0,this.barPadding=0,this.setup()}return _createClass(e,[{key:"xScale",value:function(){var e=this,t={};return 0<this.currentData.length&&(t=this.currentData.filter(function(t){return t.release_date.getTime()==e.ini_date.getTime()})),d3.scaleLog().domain([1,d3.max(t,function(t){return t.count})]).range([this.margin.left,this.width-this.margin.right-65])}},{key:"createXaxis",value:function(){var t=this.xScale(),t=d3.axisTop().scale(t).ticks(500<this.width?5:2).tickSize(-(this.height-this.margin.top-this.margin.bottom)).tickFormat(function(t){return d3.format(",")(t)});this.svg.append("g").attr("class","axis xAxis").attr("transform","translate(0, ".concat(this.margin.top,")")).call(t).selectAll(".tick line").classed("origin",function(t){return 0==t})}},{key:"yScale",value:function(){return d3.scaleLinear().domain([this.top_n,0]).range([this.height-this.margin.bottom,this.margin.top])}},{key:"updateBars",value:function(t){var e=this,n=this.xScale().domain([1,d3.max(t,function(t){return t.count})]),r=this.yScale(),t=this.svg.selectAll(".bar").data(t,function(t){return t.audio});t.enter().append("rect").attr("class",function(t){return"bar ".concat(t.audio.replace(/\s/g,"_"))}).attr("x",n(1)).attr("width",function(t){return n(t.count)-n(1)-1}).attr("y",function(t){return r(e.top_n+1)+5}).attr("height",r(1)-r(0)-this.barPadding).style("fill","#db0000").transition().duration(this.tickDuration).ease(d3.easeLinear).attr("y",function(t){return r(t.rank)+5}),t.transition().duration(this.tickDuration).ease(d3.easeLinear).attr("width",function(t){return n(t.count)-n(1)-1}).attr("y",function(t){return r(t.rank)+5}),t.exit().transition().duration(this.tickDuration).ease(d3.easeLinear).attr("width",function(t){return n(t.count)-n(1)-1}).attr("y",function(t){return r(e.top_n+10)+5}).remove()}},{key:"updateLabels",value:function(t){var e=this,n=this.xScale().domain([1,d3.max(t,function(t){return t.count})]),r=this.yScale(),t=this.svg.selectAll(".label").data(t,function(t){return t.audio});t.enter().append("text").attr("class","label").attr("x",function(t){return n(1)-8}).attr("y",function(t){return r(e.top_n+1)+5+(r(1)-r(0))/2}).style("text-anchor","end").style("fill","whitesmoke").text(function(t){return t.audio}).transition().duration(this.tickDuration).ease(d3.easeLinear).attr("y",function(t){return r(t.rank)+5+(r(1)-r(0))/2}),t.transition().duration(this.tickDuration).ease(d3.easeLinear).attr("x",n(1)-8).attr("y",function(t){return r(t.rank)+5+(r(1)-r(0))/2}),t.exit().transition().duration(this.tickDuration).ease(d3.easeLinear).attr("x",function(t){return n(1)-8}).attr("y",function(t){return r(e.top_n+10)+5}).remove()}},{key:"updateValueLabels",value:function(t){var e=this,n=this.xScale().domain([1,d3.max(t,function(t){return t.count})]),r=this.yScale(),t=this.svg.selectAll(".valueLabel").data(t,function(t){return t.audio});t.enter().append("text").attr("class","valueLabel").attr("x",function(t){return n(t.count)+5}).attr("y",function(t){return r(t.rank)+5+(r(1)-r(0))/2+1}).style("fill","whitesmoke").transition().duration(this.tickDuration).tween("textTween",function(t){var e=d3.interpolate(this.textContent,t.count);return function(t){this.textContent=Math.round(e(t))}}),t.transition().duration(this.tickDuration).ease(d3.easeLinear).attr("x",function(t){return n(t.count)+5}).attr("y",function(t){return r(t.rank)+5+(r(1)-r(0))/2+1}).tween("textTween",function(t){var e=d3.interpolate(this.textContent,t.count);return function(t){this.textContent=Math.round(e(t))}}),t.exit().transition().duration(this.tickDuration).ease(d3.easeLinear).attr("x",function(t){return n(t.count)+5}).attr("y",function(t){return r(e.top_n+10)+5}).tween("textTween",function(t){var e=d3.interpolate(this.textContent,t.count);return function(t){this.textContent=Math.round(e(t))}})}},{key:"binarySearch",value:function(t,e){var n=0,r=t.length-1;if(t[n].release_date>e)return 0;if(t[r].release_date<=e)return t[r].count;for(;n<=r;){var a=Math.floor((n+r)/2),i=t[a].release_date;if(i==e)return t[a].count;e<i?r=a-1:n=a+1}return t[n-1].count}},{key:"updateData",value:function(){var n=this,r=this.ini_date.getTime(),t=Object.entries(this.currentData).map(function(t){var e=_slicedToArray(t,2),t=e[0],e=e[1];return{audio:t,count:n.binarySearch(e,r)}}).sort(function(t,e){return e.count-t.count}).slice(0,this.top_n);t.forEach(function(t,e){return t.rank=e});this.xScale().domain([1,d3.max(t,function(t){return t.count})]);0<t.length&&(this.updateBars(t),this.updateLabels(t),this.updateValueLabels(t)),this.ini_date=new Date(this.ini_date.setDate(this.ini_date.getDate()+1))}},{key:"setup",value:function(){this.width=2e3,this.height=960,this.margin={top:50,right:40,bottom:30,left:125},this.svg.attr("viewBox","0 0 ".concat(this.width," ").concat(this.height)),this.ini_date=new Date("2015-04-14"),this.top_n=10,this.tickDuration=200,this.barPadding=(this.height-(this.margin.bottom+this.margin.top))/(5*this.top_n),this.svg.append("g").attr("height","translate(0, ".concat(this.height-50,")")),this.createXaxis()}}]),e}();function instantiateRacingBars(t,e){var r=new RacingBarsAudio(t),n=["January","February","March","April","May","June","July","August","September","October","November","December"];new TimeSelector("racing-audio-time-selection",[new Date("04-14-2015"),new Date("04-08-2020")],function(t){r.ini_date=t,r.updateData()},6e4,"date",function(t){return"".concat(n[t.getMonth()]," ").concat(t.getFullYear())});d3.csv(e).then(function(t){var n={};t.forEach(function(t){var e=t.audio;void 0===n[e]&&(n[e]=[]),n[e].push({count:+t.count,release_date:new Date(t.release_date)})}),r.currentData=n,r.updateData()})}$(function(){instantiateRacingBars(d3.select("svg#most-languages"),"data/racing_audio.csv")});
//# sourceMappingURL=language_racing.js.map
