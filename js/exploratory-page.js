"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function map(t,a){var n=$("#".concat(t));n.vectorMap({map:"world_mill",hoverColor:!1,backgroundColor:"#000",regionsSelectable:!0,regionsSelectableOne:!0,regionStyle:{initial:{fill:"gray","fill-opacity":1},hover:{"fill-opacity":.8},selected:{fill:"#DB0000"},selectedHover:{"fill-opacity":1}},zoomMax:8,zoomMin:1,zoomStep:1.6,onRegionSelected:function(t,e,o){o&&(e=n.vectorMap("get","mapObject").getRegionName(e),a(e))}})}function filterMultiReduce(t,o,a){var n={},i=Object.keys(o);return i.forEach(function(t){return n[t]=void 0}),t.forEach(function(e){a(e)&&i.forEach(function(t){n[t]=o[t](n[t],e)})}),n}function parseArrayOfInts(t){return t.split(",").map(function(t){return+t})}var ExploratoryTool=function(){function s(t,e,o,a,n,i,r){_classCallCheck(this,s),this.exploratoryData=void 0,this.selected={country:void 0,interval:void 0},this.audioBarPlot=void 0,this.idToCountryMapping=void 0,this.countryToIdMapping=void 0,this.sideBar=$("#".concat(e)),this.statisticsBar=$("#".concat(o)),this.preparePlots(a),this.startEploratoryDataLoading(i),this.startselectionElementCreation(t,n),this.startLoadingMappings(r)}return _createClass(s,[{key:"fillAudioPlot",value:function(t){this.fillAudioWithNonAppearing(t);var e=Object.entries(t).sort(function(t,e){return e[1]-t[1]}).slice(0,5),t=e.map(function(t){return t[1]}),e=e.map(function(t){return t[0]});this.audioBarPlot.updateData(t),this.audioBarPlot.updateLabels(e)}},{key:"handleNoData",value:function(){this.sideBar.html("No data available"),this.statisticsBar.html("No data available"),this.fillAudioPlot({})}},{key:"fillAudioWithNonAppearing",value:function(t){for(var e=0,o=["English","Hindi","Spanish","Japanese","Italian","Korean","Mandarin"];e<o.length;e++){var a=o[e];void 0===t[a]&&(t[a]=0)}}},{key:"displayData",value:function(t){void 0===t.audioCount&&(t.audioCount={}),this.fillAudioPlot(t.audioCount),this.sideBar.html("\n      Top movies:\n      <ol>\n        ".concat(void 0===t.topMovies?"No data available":t.topMovies.arr.filter(function(t){return void 0!==t}).map(function(t){return"<li>".concat(t.title,"</li>")}).join("\n"),"\n      </ol>\n      Top TV shows:\n      <ol>\n        ").concat(void 0===t.topMovies?"No data available":t.topShows.arr.filter(function(t){return void 0!==t}).map(function(t){return"<li>".concat(t.title,"</li>")}).join("\n"),"\n      </ol>\n    ")),this.statisticsBar.html("\n      <p>Number of movies: <b>".concat(t.numberOfTitles[0],"</b></p>\n\n      <p>Average length of a movie: <b>").concat(Math.round(t.averageDuration[0]/t.averageDuration[1])," minutes</b></p>\n\n      <p>Number of TV Shows: <b>").concat(t.numberOfTitles[1],"</b></p>\n\n      <p>Average duration of a TV show: <b>").concat((t.averageNumberOfSeasons[0]/t.averageNumberOfSeasons[1]).toFixed(2)," seasons</b></p>\n    "))}},{key:"updateData",value:function(){var e,t,o=this;void 0!==this.exploratoryData&&void 0!==this.selected.country&&void 0!==this.selected.interval&&void 0!==(e=this.countryToIdMapping[this.selected.country])?(t=filterMultiReduce(this.exploratoryData,{topMovies:this.topMoviesReducer(5),topShows:this.topShowsReducer(5),numberOfTitles:this.countMoviesShows,averageDuration:this.attrAverageDataReducer("duration"),averageNumberOfSeasons:this.attrAverageDataReducer("number of seasons"),audioCount:this.countAudio},function(t){return t.countries.has(e)&&t["release date on Netflix"]>=o.selected.interval[0]&&t["release date on Netflix"]<=o.selected.interval[1]}),this.displayData(t)):this.handleNoData()}},{key:"countAudio",value:function(t,e){e=e.audio;return void 0===(t=void 0===t?{}:t)[e]?t[e]=1:t[e]+=1,t}},{key:"attrAverageDataReducer",value:function(o){return function(t,e){void 0===t&&(t=[0,0]);e=+e[o];return!isNaN(e)&&0<e&&(t[0]+=+e,t[1]++),t}}},{key:"countMoviesShows",value:function(t,e){return void 0===t&&(t=[0,0]),isNaN(e.duration)?isNaN(e["number of seasons"])||t[1]++:t[0]++,t}},{key:"topMoviesReducer",value:function(o){return function(t,e){return void 0===t&&(t=new SortedCollection(o,function(t,e){return t.metacritic>e.metacritic})),isNaN(e.duration)||isNaN(e.metacritic)||t.tryToInsert(e),t}}},{key:"topShowsReducer",value:function(o){return function(t,e){return void 0===t&&(t=new SortedCollection(o,function(t,e){return t.metacritic>e.metacritic})),isNaN(e["number of seasons"])||isNaN(e.metacritic)||t.tryToInsert(e),t}}},{key:"startselectionElementCreation",value:function(i,t){var r=this;d3.csv(t).then(function(t){for(var e=[],o=0;o<t.length;o++)e.push({month:new Date(t[o]["release month"]),count:0<t[o].count?Math.log(t[o].count):0});function a(t){return("0"+t).slice(-2)}new RangeSelector("exporatory-time-selection",e,function(t,e){r.selected.interval=[t,e],r.updateData()},function(t){return"".concat(a(t.getDate()),"-").concat(a(t.getMonth()+1),"-").concat(a(t.getFullYear()))});var n={"United Kingdom":"UK","United States":"USA","United Arab Emirates":"UAE"};map(i,function(t){var e=n[t];(t=void 0!==e?e:t)!==r.selected.country&&(r.selected.country=t,r.updateData())})})}},{key:"preparePlots",value:function(t){this.audioBarPlot=new SimpleBarPlot(t,["English","Japanese","Chinese","Portugese","Latin"],1200,380,100)}},{key:"startEploratoryDataLoading",value:function(t){var e=this;d3.csv(t).then(function(t){e.exploratoryData=t,e.exploratoryData.forEach(function(t){t.imdb=parseFloat(t.imdb),t.metacritic=parseFloat(t.metacritic),t.duration=parseFloat(t.duration),t["number of seasons"]=parseFloat(t["number of seasons"]),t["release date on Netflix"]=new Date(t["release date on Netflix"]),t.countries=new Set(parseArrayOfInts(t.countries))})})}},{key:"startLoadingMappings",value:function(t){var e=this;d3.csv(t).then(function(t){e.idToCountryMapping={},e.countryToIdMapping={},t.forEach(function(t){e.idToCountryMapping[+t.id]=t.name,e.countryToIdMapping[t.name]=+t.id})})}}]),s}();$(function(){new ExploratoryTool("exploratory-tool-world-map","exploratory-side-bar","statistics-side-bar","exploratory-tool-audio-bar-plot","data/release_density_per_month.csv","data/exploratory_data.csv","data/countries.csv")});
//# sourceMappingURL=exploratory-page.js.map
