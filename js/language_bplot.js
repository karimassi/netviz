"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var RacingBarsAudio=function(){function e(t){_classCallCheck(this,e),this.svg=t,this.currentData={},this.datetext={},this.datesValues={},this.width=0,this.height=0,this.margin={},this.ini_date=0,this.top_n=0,this.tickDuration=0,this.barPadding=0,this.setup()}return _createClass(e,[{key:"xScale",value:function(){var e=this,t={};return 0<this.currentData.length&&(t=this.currentData.filter(function(t){return t.release_date==e.datesValues[e.ini_date]})),d3.scaleLog().domain([1,d3.max(t,function(t){return t.count})]).range([this.margin.left,this.width-this.margin.right-65])}},{key:"createXaxis",value:function(){var t=this.xScale(),t=d3.axisTop().scale(t).ticks(500<this.width?5:2).tickSize(-(this.height-this.margin.top-this.margin.bottom)).tickFormat(function(t){return d3.format(",")(t)});this.svg.append("g").attr("class","axis xAxis").attr("transform","translate(0, ".concat(this.margin.top,")")).call(t).selectAll(".tick line").classed("origin",function(t){return 0==t})}},{key:"yScale",value:function(){return d3.scaleLinear().domain([this.top_n,0]).range([this.height-this.margin.bottom,this.margin.top])}},{key:"dateText",value:function(){var e=this;return this.svg.append("text").attr("class","dateText").attr("x",this.width-this.margin.right).attr("y",this.height-25).style("text-anchor","end").style("fill","#ffffff").text(function(t){return e.datesValues[e.ini_date]}).call(function(t,e){t.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("fill","#000000").style("stroke","#000000").style("stroke-width",e).style("stroke-linejoin","round").style("opacity",1)},10)}},{key:"intiateBars",value:function(t){var e=this.xScale().domain([1,d3.max(t,function(t){return t.count})]),n=this.yScale();this.svg.selectAll("rect.bar").data(t,function(t){return t.audio}).enter().append("rect").attr("class","bar").attr("x",e(1)).attr("width",function(t){return e(t.count)-e(1)-1}).attr("y",function(t){return n(t.rank)+5}).attr("height",n(1)-n(0)-this.barPadding).style("fill","#db0000"),this.svg.selectAll("text.label").data(t,function(t){return t.audio}).enter().append("text").attr("class","label").attr("x",function(t){return e(1)-8}).attr("y",function(t){return n(t.rank)+5+(n(1)-n(0))/2+1}).style("text-anchor","end").style("fill","whitesmoke").text(function(t){return t.audio}),this.datetext=this.dateText()}},{key:"updateBars",value:function(t){var e=this,n=this.xScale().domain([1,d3.max(t,function(t){return t.count})]),i=this.yScale(),t=this.svg.selectAll(".bar").data(t,function(t){return t.audio});t.enter().append("rect").attr("class",function(t){return"bar ".concat(t.audio.replace(/\s/g,"_"))}).attr("x",n(1)).attr("width",function(t){return n(t.count)-n(1)-1}).attr("y",function(t){return i(e.top_n+1)+5}).attr("height",i(1)-i(0)-this.barPadding).style("fill","#db0000").transition().duration(this.tickDuration).ease(d3.easeLinear).attr("y",function(t){return i(t.rank)+5}),t.transition().duration(this.tickDuration).ease(d3.easeLinear).attr("width",function(t){return n(t.count)-n(1)-1}).attr("y",function(t){return i(t.rank)+5}),t.exit().transition().duration(this.tickDuration).ease(d3.easeLinear).attr("width",function(t){return n(t.count)-n(1)-1}).attr("y",function(t){return i(e.top_n+10)+5}).remove()}},{key:"updateLabels",value:function(t){var e=this,n=this.xScale().domain([1,d3.max(t,function(t){return t.count})]),i=this.yScale(),t=this.svg.selectAll(".label").data(t,function(t){return t.audio});t.enter().append("text").attr("class","label").attr("x",function(t){return n(1)-8}).attr("y",function(t){return i(e.top_n+1)+5+(i(1)-i(0))/2}).style("text-anchor","end").style("fill","whitesmoke").text(function(t){return t.audio}).transition().duration(this.tickDuration).ease(d3.easeLinear).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}),t.transition().duration(this.tickDuration).ease(d3.easeLinear).attr("x",n(1)-8).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}),t.exit().transition().duration(this.tickDuration).ease(d3.easeLinear).attr("x",function(t){return n(1)-8}).attr("y",function(t){return i(e.top_n+10)+5}).remove()}},{key:"ticker",value:function(){var n=this,i=d3.interval(function(t){var e=n.currentData.filter(function(t){return t.release_date==n.datesValues[n.ini_date]}).sort(function(t,e){return d3.ascending(t,e)}).slice(0,n.top_n);e.forEach(function(t,e){return t.rank=e});n.xScale().domain([1,d3.max(e,function(t){return t.count})]);n.updateBars(e),n.updateLabels(e),n.datetext.text(function(t){return n.datesValues[n.ini_date]}),n.datesValues[n.ini_date]==n.datesValues.slice(-1)&&i.stop(),++n.ini_date},this.tickDuration)}},{key:"setup",value:function(){this.width=2e3,this.height=960,this.margin={top:50,right:40,bottom:30,left:125},this.svg.attr("viewBox","0 0 ".concat(this.width," ").concat(this.height)),this.top_n=10,this.tickDuration=200,this.barPadding=(this.height-(this.margin.bottom+this.margin.top))/(5*this.top_n),this.svg.append("g").attr("height","translate(0, ".concat(this.height-50,")")),this.createXaxis()}}]),e}();function instantiateRacingBars(t,e){var n=new RacingBarsAudio(t);d3.csv(e).then(function(t){t.forEach(function(t){t.count=+t.count,t.release_date=t.release_date}),n.currentData=t,n.datesValues=d3.map(t,function(t){return t.release_date}).keys();t=t.filter(function(t){return t.release_date==n.datesValues[n.ini_date]}).sort(function(t,e){return d3.ascending(t,e)}).slice(0,n.top_n);t.forEach(function(t,e){return t.rank=e}),n.intiateBars(t),n.ticker()})}
//# sourceMappingURL=language_bplot.js.map
