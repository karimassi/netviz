"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _iterableToArrayLimit(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(i=n.next()).done)&&(o.push(i.value),!e||o.length!==e);a=!0);}catch(t){s=!0,r=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var RangeSelector=function(){function i(t,e,n){_classCallCheck(this,i),this.svg=d3.select("#".concat(t)),this.id=t,this.points=e,this.selectionTools={},this.percentScaling=void 0,this.reversedPercentScaling=void 0,this.selectionRect=void 0,this.plot=void 0,this.draggedSide=void 0,this.positionToDateScaling=void 0,this.callback=n,this.setup()}return _createClass(i,[{key:"updateSelectionRect",value:function(){var t=Math.min(this.selectionTools.left.line.attr("x1"),this.selectionTools.right.line.attr("x1")),e=Math.abs(this.selectionTools.right.line.attr("x1")-this.selectionTools.left.line.attr("x1"));this.selectionRect.attr("x",t).attr("width",e)}},{key:"getPosition",value:function(t){return parseFloat(this.selectionTools[t].line.attr("x1"))}},{key:"emitPosition",value:function(){var t=this.positionToDateScaling(this.getPosition("left")),e=new Date(t.getTime()),t=this.positionToDateScaling(this.getPosition("right")),t=new Date(t.getTime());this.callback(e,t)}},{key:"moveSelectionTool",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];e=Math.max(0,Math.min(1,e));var i=this.selectionTools[t],r=this.percentScaling(e);if(n)switch(t){case"right":r=Math.max(r,this.getPosition("left")+20);break;case"left":r=Math.min(r,this.getPosition("right")-20);break;default:console.log("Trying to move unsupported side")}i.line.attr("x1",r).attr("x2",r),i.triangle.attr("transform","translate(".concat(r," 8) rotate(180)")),this.updateSelectionRect()}},{key:"handleMouseDown",value:function(){var n,i,r=this,t=_slicedToArray(d3.mouse(this.plot.node()),2),o=t[0];t[1]<=40&&(n=10,i="",["left","right"].forEach(function(t){var e=Math.abs(o-r.selectionTools[t].line.attr("x1"));e<n&&(n=e,i=t)}),""!==i&&(this.draggedSide=i))}},{key:"handleMouseMove",value:function(){var t,e;void 0!==this.draggedSide&&(e=(t=_slicedToArray(d3.mouse(this.plot.node()),2))[0],t[1],this.moveSelectionTool(this.draggedSide,this.reversedPercentScaling(e),!0))}},{key:"handleMouseUp",value:function(){void 0!==this.draggedSide&&(this.draggedSide=void 0,this.emitPosition())}},{key:"createPlot",value:function(t,e,n){var i=this;this.points.sort(function(t,e){return t.month-e.month});for(var r=this.points[0].month,o=this.points[this.points.length-1].month,a=[Number.MAX_SAFE_INTEGER,0],s=a[0],l=a[1],c=0;c<this.points.length;c++)var h=this.points[c].count,s=Math.min(s,h),l=Math.max(l,h);var t=[n,t-n],n=[r,o],u=d3.scaleTime().domain(n).range(t);this.positionToDateScaling=d3.scaleTime().domain(t).range(n),this.percentScaling=d3.scaleLinear().domain([0,1]).range(t),this.reversedPercentScaling=d3.scaleLinear().domain(t).range([0,1]);var d=d3.scaleLinear().domain([0,l]).range([40,20]),r=d3.area().curve(d3.curveCatmullRom.alpha(.5)).x(function(t){return u(t.month)}).y0(40).y1(function(t){return d(t.count)});this.plot=this.svg.append("path").data([this.points]).attr("fill","whitesmoke").attr("d",r),this.selectionRect=this.svg.append("rect").attr("x",100).attr("y",10).attr("width",100).attr("height",30).attr("fill","rgba(255, 0, 0, .2)");o=this.svg.append("line").attr("x1",0).attr("x2",0).attr("y1",7).attr("y2",40).attr("stroke","whitesmoke").style("stroke-dasharray","3, 1"),n=this.svg.append("line").attr("x1",500).attr("x2",500).attr("y1",7).attr("y2",40).attr("stroke","whitesmoke").style("stroke-dasharray","3, 1"),t=this.svg.append("path").attr("d",d3.symbol().type(d3.symbolTriangle).size(20)).attr("fill","whitesmoke").attr("transform","translate(100 8) rotate(180)"),r=this.svg.append("path").attr("d",d3.symbol().type(d3.symbolTriangle).size(20)).attr("fill","whitesmoke").attr("transform","translate(200 8) rotate(180)");this.selectionTools={left:{line:o,triangle:t},right:{line:n,triangle:r}},this.moveSelectionTool("left",0),this.moveSelectionTool("right",1),this.svg.selectAll("text").data([2015,2016,2017,2018,2019,2020,2021]).enter().append("text").attr("fill","whitesmoke").attr("x",function(t){return u(new Date("01-01-".concat(t)))}).attr("y",44).style("font-size",".5em").style("user-select","none").style("text-anchor","middle").style("alignment-baseline","hanging").text(function(t){return t}),this.svg.on("mousedown",function(){return i.handleMouseDown()}),d3.select("body").on("mousemove.".concat(this.id),function(){return i.handleMouseMove()}).on("mouseup.".concat(this.id),function(){return i.handleMouseUp()})}},{key:"setup",value:function(){this.svg.attr("viewBox","0 0 ".concat(500," ").concat(55)),this.createPlot(500,55,10)}}]),i}();$(function(){d3.csv("data/release_density_per_month.csv").then(function(t){for(var e=[],n=0;n<t.length;n++)e.push({month:new Date(t[n]["release month"]),count:t[n].count});new RangeSelector("exporatory-time-selection",e,function(t,e){return console.log("".concat(t,", ").concat(e))})})});
//# sourceMappingURL=range_selection.js.map
