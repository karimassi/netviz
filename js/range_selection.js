"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(a="Object"===a&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function _iterableToArrayLimit(t,e){var a=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=a){var i,r,n=[],o=!0,s=!1;try{for(a=a.call(t);!(o=(i=a.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){s=!0,r=t}finally{try{o||null==a.return||a.return()}finally{if(s)throw r}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}var RangeSelector=function(){function r(t,e,a,i){_classCallCheck(this,r),this.svg=d3.select("#".concat(t)),this.id=t,this.points=e,this.selectionTools={},this.percentScaling=void 0,this.reversedPercentScaling=void 0,this.selectionRect=void 0,this.plot=void 0,this.draggedSide=void 0,this.positionToDateScaling=void 0,this.callback=a,this.dateFormatter=i,this.setup()}return _createClass(r,[{key:"updateSelectionRect",value:function(){var t=Math.min(this.selectionTools.left.line.attr("x1"),this.selectionTools.right.line.attr("x1")),e=Math.abs(this.selectionTools.right.line.attr("x1")-this.selectionTools.left.line.attr("x1"));this.selectionRect.attr("x",t).attr("width",e)}},{key:"getPosition",value:function(t){return parseFloat(this.selectionTools[t].line.attr("x1"))}},{key:"emitPosition",value:function(){var t=this.positionToDateScaling(this.getPosition("left")),e=new Date(t.getTime()),t=this.positionToDateScaling(this.getPosition("right")),t=new Date(t.getTime());this.callback(e,t)}},{key:"moveSelectionTool",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];e=Math.max(0,Math.min(1,e));var i=this.selectionTools[t],r=this.percentScaling(e);if(a)switch(t){case"right":r=Math.max(r,this.getPosition("left")+40);break;case"left":r=Math.min(r,this.getPosition("right")-40);break;default:console.log("Trying to move unsupported side")}i.line.attr("x1",r).attr("x2",r),i.triangle.attr("transform","translate(".concat(r," 18) rotate(180)")),i.display.attr("transform","translate(".concat(r," 7)")),i.displayText.attr("transform","translate(".concat(r," 8)")),i.displayText.text(this.dateFormatter(this.positionToDateScaling(r))),this.updateSelectionRect()}},{key:"handleMouseDown",value:function(){var a,i,r=this,t=_slicedToArray(d3.mouse(this.plot.node()),2),n=t[0];t[1]<=40&&(a=10,i="",["left","right"].forEach(function(t){var e=Math.abs(n-r.selectionTools[t].line.attr("x1"));e<a&&(a=e,i=t)}),""!==i&&(this.draggedSide=i))}},{key:"handleMouseMove",value:function(){var t,e;void 0!==this.draggedSide&&(e=(t=_slicedToArray(d3.mouse(this.plot.node()),2))[0],t[1],this.moveSelectionTool(this.draggedSide,this.reversedPercentScaling(e),!0))}},{key:"handleMouseUp",value:function(){void 0!==this.draggedSide&&(this.draggedSide=void 0,this.emitPosition())}},{key:"createPlot",value:function(t,e,a){var i=this;this.points.sort(function(t,e){return t.month-e.month});for(var r=this.points[0].month,n=this.points[this.points.length-1].month,o=[Number.MAX_SAFE_INTEGER,0],s=o[0],l=o[1],h=0;h<this.points.length;h++)var c=this.points[h].count,s=Math.min(s,c),l=Math.max(l,c);var d=[a,t-a],u=[r,n],g=d3.scaleTime().domain(u).range(d);this.positionToDateScaling=d3.scaleTime().domain(d).range(u),this.percentScaling=d3.scaleLinear().domain([0,1]).range(d),this.reversedPercentScaling=d3.scaleLinear().domain(d).range([0,1]);var y=d3.scaleLinear().domain([0,l]).range([50,30]),p=d3.area().curve(d3.curveCatmullRom.alpha(.5)).x(function(t){return g(t.month)}).y0(50).y1(function(t){return y(t.count)});this.plot=this.svg.append("path").data([this.points]).attr("fill","whitesmoke").attr("d",p),this.selectionRect=this.svg.append("rect").attr("x",100).attr("y",20).attr("width",100).attr("height",30).attr("fill","rgba(255, 0, 0, .2)");o=this.svg.append("line").attr("x1",0).attr("x2",0).attr("y1",17).attr("y2",50).attr("stroke","whitesmoke").style("stroke-dasharray","3, 1"),t=this.svg.append("line").attr("x1",500).attr("x2",500).attr("y1",17).attr("y2",50).attr("stroke","whitesmoke").style("stroke-dasharray","3, 1"),a=this.svg.append("path").attr("d",d3.symbol().type(d3.symbolTriangle).size(20)).attr("fill","whitesmoke").attr("transform","translate(100 18) rotate(180)"),r=this.svg.append("path").attr("d",d3.symbol().type(d3.symbolTriangle).size(20)).attr("fill","whitesmoke").attr("transform","translate(200 18) rotate(180)"),n=this.svg.append("rect").attr("x",-20).attr("y",-3).attr("width",40).attr("height",13).attr("fill","white").attr("rx",4).attr("transform","translate(0 0)"),u=this.svg.append("rect").attr("x",-20).attr("y",-3).attr("width",40).attr("height",13).attr("fill","white").attr("rx",4).attr("transform","translate(0 0)"),d=this.svg.append("text").attr("fill","black").style("font-size",".39em").style("user-select","none").style("text-anchor","middle").style("alignment-baseline","hanging").text("01-01-1970"),p=this.svg.append("text").attr("fill","black").style("font-size",".39em").style("user-select","none").style("text-anchor","middle").style("alignment-baseline","hanging").text("01-01-1970");this.selectionTools={left:{displayText:d,display:n,line:o,triangle:a},right:{displayText:p,display:u,line:t,triangle:r}},this.moveSelectionTool("left",0),this.moveSelectionTool("right",1),this.svg.selectAll("text.years").data([2015,2016,2017,2018,2019,2020,2021]).enter().append("text").attr("class","years").attr("fill","whitesmoke").attr("x",function(t){return g(new Date("01-01-".concat(t)))}).attr("y",54).style("font-size",".5em").style("user-select","none").style("text-anchor","middle").style("alignment-baseline","hanging").text(function(t){return t}),this.svg.on("mousedown",function(){return i.handleMouseDown()}),d3.select("body").on("mousemove.".concat(this.id),function(){return i.handleMouseMove()}).on("mouseup.".concat(this.id),function(){return i.handleMouseUp()}),this.emitPosition()}},{key:"setup",value:function(){this.svg.attr("viewBox","0 0 ".concat(500," ").concat(65)),this.createPlot(500,65,30)}}]),r}();
//# sourceMappingURL=range_selection.js.map
